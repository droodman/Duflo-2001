--------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  D:\OneDrive\Documents\Work\Clients & prospects\GiveWell\Education\Duflo 2001\Public\Output\duflo2
> 001.log
  log type:  text
 opened on:  22 Jul 2022, 12:23:06

. 
. 
. ***
. *** Data prep
. ***
. {
.   cap noi odbc load, clear dsn("Duflo 2001") table("Regency-level vars")
variable Schools77new was byte now int
variable Schools78new was byte now int
variable Schools75new was byte now int
variable Schools76new was byte now int
variable Schools73new was byte now int
.   if !_rc {
.     gen nen71new = 1 - en71new
.     gen nen71newish = 1 - en71newish
.     label var birthpl "Birth province & regency code, 1995"
.     label var nin "Number of new schools, Duflo"
.     label var recp "High treatment dummy, Duflo"
.     label var ch71 "Number of children 5-14, 1971, Duflo"
.     label var en71 "Population enrollment rate, 1971, Duflo"
.     label var wsppc "Water & sanitation spending per capita, Duflo"
.     label var dens71 "Population density, 1971, Duflo"
.     label var dens71 "Population density, 1971, Duflo"
.     label var moldyed "Average education among old, Duflo"
.     label var birthlat "Birth regency centroid latitude"
.     label var birthlong "Birth regency centroid longitude"
.     label var Schools73new "Number of new schools, 1973/74"
.     label var Schools74new "Number of new schools, 1974/75"
.     label var Schools75new "Number of new schools, 1975/76"
.     label var Schools76new "Number of new schools, 1976/77"
.     label var Schools77new "Number of new schools, 1977/78"
.     label var Schools78new "Number of new schools, 1978/79"
.     label var pop71new "Regency population, 1971"
.     label var ch71new "Population 5-14, 1971"
.     label var totinnew "Number of new schools"
.     label var ninnew "Number of new schools per 5-14 population"
.     label var nch71new "Population 5+, 1971, same source as for attendance"
.     label var atsc71new "Population 5+ attending school, 1971"
.     label var en71newish "Population enrollment rate, 1971, ch71new denominator"
.     label var en71new "Population 5+ enrollment rate, 1971, nch71new denominator"
.     label var nen71newish "Population non-enrollment rate, 1971, ch71new denominator"
.     label var nen71new "Population 5+ non-enrollment rate, 1971, nch71new denominator"
.     saveold "Public\Regency-level vars\Regency-level vars", replace ver(11)
(saving in Stata 12 format, which Stata 11 can read)
file Public\Regency-level vars\Regency-level vars.dta saved
.   }
.   else use "Public\Regency-level vars\Regency-level vars", clear
. 
.   scatter ninnew nen71new, msym(Oh) || lfit ninnew nen71new, legend(off) scheme(plottig) xtitle("Non-enrollm
> ent rate, ages 5 and up, 1971") ytitle("Planned new schools 1973/74â€“78/79 per 1,000 children") graphregion(m
> argin(zero)) name(targeting, replace)
.   graph save Public\Output\targeting, replace
file Public\Output\targeting.gph saved
. 
.   gen ninnew7374 = (Schools73new + Schools74new)/ch71
(8 missing values generated)
.   gen ninnew7576 = (Schools75new + Schools76new)/ch71
(8 missing values generated)
.   gen ninnew7778 = (Schools77new + Schools78new)/ch71
(8 missing values generated)
.   corr nen71new ninnew*
(obs=282)

             | nen71new   ninnew nin~7374 nin~7576 nin~7778
-------------+---------------------------------------------
    nen71new |   1.0000
      ninnew |   0.0340   1.0000
  ninnew7374 |   0.0683   0.3873   1.0000
  ninnew7576 |  -0.0386   0.6824   0.4014   1.0000
  ninnew7778 |   0.0233   0.8867   0.3785   0.5376   1.0000

.   
. 
.   * post-1995 data
. 
.   if "$source95" != "NBER" {
.     #delimit;
delimiter now ;
.     odbc load, clear dsn("Duflo 2001") exec("
>       SELECT YEAR as year, RELATE as relate, 2-URBAN as urban, YRSCHOOL, EDUCATT, BIRTHYR as birthyr, PERWT 
> as wt, INDGEN as indgen, OCC as occ, CLASSWK as classwk, BPLPROV as birthprov, BPLREG as birthpl, birthlat, 
> birthlong
>       FROM dbo.[IPUMS-based dataset]
>       where year=2005 and Male=1 and BPLPROV<>96
>     ");
.     #delimit cr
delimiter now cr
. 
.     replace occ = floor(occ/10)  // 2005 4-digit classification => 1995 3-digit
.     recode EDUCATT (11=1) (12=2) (13=3) (14=4) (15=5) (16 17=6) ///  // primary school
>                    (21=7) (22=8) (23 27=9) (31=10) (32=11) (33=12)         (37=12) ///  // junior & senior
>                                            (41=10) (42=11) (43=12) (44=13) (47=12) ///  //          senior, 
> vocational
>                    (51=13) (52 57=14) ///  // Diploma I/II
>                    (61=13) (62=14) (63 67=15) ///  // Academy/Diploma III
>                    (71=13) (72=14) (73=15) (74=16) (75=17) (76=18) (77=17) ///  // University/Diploma IV
>                                                            (86=18) (87=17) ///  // Postgraduate-S2/S3 -- not
>  broken out in 1995
>                    (99=0) (.=0), gen(yeduc)
.   //   replace yeduc = yeduc - 1 if EDUCATT==57 & occ==13  // 1 less year for Diploma I/II in teaching; go b
> y occupation for lack of study field in 2005
. 
.     gen lwage = .
.     gen lhwage = .
.     keep  year relate urban yeduc birthyr wt indgen occ birthpl birthprov classwk lwage lhwage birthlat birt
> hlong
.     order year relate urban yeduc birthyr wt indgen occ birthpl birthprov classwk lwage lhwage birthlat birt
> hlong
.     compress
.     save SUPAS05, replace
. 
.     * SAKERNAS
.     #delimit;
delimiter now ;
.     odbc load, clear dsn("Duflo 2001") exec("
>       SELECT B5P1A, B5P6B, 2010-UMUR as birthyr, WEIGHT as wt, B5P12A+B5P12B as wage, ID1995A_BPLREG AS birt
> hpl, floor(ID1995A_BPLREG/100) as birthprov
>       FROM  [SAKERNAS 2010] LEFT OUTER JOIN
>                [SUPAS 1995-2010 regency concordance] ON respl = [SUPAS 1995-2010 regency concordance].regy20
> 10
>       where JK=1 and B1P01<>31  --men outside Jakarta, copying Duflo (2004)
>     ");
.     #delimit cr
delimiter now cr
. 
.     replace wage = wage * .194  // adjust for inflation https://data.worldbank.org/indicator/FP.CPI.TOTL?end
> =2010&locations=US%E2%89%A4%2FSEURLD-ID&start=1995
.     gen hwage = wage / 4 / B5P6B
.     gen lwage = ln(wage)
.     gen lhwage = ln(hwage)
.     gen byte relate = .
.     gen byte indgen = .
.     gen byte occ = .
.     gen byte urban = .
.     gen byte birthlat = .
.     gen byte birthlong = .
.     gen byte classwk = .
.     gen int year = 2010
. 
.     recode B5P1A (1=0) (2=3) (3=6) ///  // no/some/completed primary school
>                  (4 5=9) (6 7=12) ///  // junior & senior
>                  (8=14) ///  // Diploma I/II
>                  (9=15) ///  // Academy/Diploma III
>                  (10=17) ///  // University/Diploma IV
>                  (11=17), gen(yeduc)  // Postgraduate-S2/S3 -- not broken out in 1995
.     keep  year relate urban yeduc birthyr wt indgen occ birthpl birthprov classwk lwage lhwage birthlat birt
> hlong  // "birth" fields are actually for residence
.     order year relate urban yeduc birthyr wt indgen occ birthpl birthprov classwk lwage lhwage birthlat birt
> hlong
.     compress
.     save SAKERNAS10, replace
.     
.     * SUSENAS
.     #delimit;
delimiter now ;
.     odbc load, clear dsn("Duflo 2001") exec("
>       SELECT year, c2.ID1995A_BPLREG AS birthpl, B5_TL1 AS birthprov, B5R15, B5R29, B5R28B, year - UMUR AS b
> irthyr, FWT_TAHUN AS wt, HB as relate
>       FROM  [SUPAS95-geo2_id1995 regency concordance] AS c2 RIGHT OUTER JOIN
>                [SUPAS 1995-2010 regency concordance] AS c1 ON c2.ID1995A_BPLREG = c1.ID1995A_BPLREG RIGHT OU
> TER JOIN
>                SUSENAS ON c1.regy2010 = birthpl
>       WHERE JK = 1  --men
>     ");
.     #delimit cr
delimiter now cr
. 
.     replace B5R29 = B5R29 * (.194 / cond(year==2103, 1.169, 1.244))  // adjust for inflation, 2013/14->1995 
> https://data.worldbank.org/indicator/FP.CPI.TOTL?end=2013&locations=US%E2%89%A4%2FSEURLD-ID&start=1995
.     gen hwage = B5R29 / 4 / B5R28B
.     gen lwage = ln(B5R29)
.     gen lhwage = ln(hwage)
.     gen byte indgen = .
.     gen byte occ = .
.     gen byte classwk = .
.     gen byte urban = .
.     gen byte birthlat = .
.     gen byte birthlong = .
.   
.     recode B5R15 (1 2 3 = 0) (4 5 6 = 6) (7 8 9 10 = 9) (11 12 13 14 = 12), gen(yeduc)  // years of schoolin
> g *before* each schooling level
.     mat completionyears = 6, 6, 6, 3, 3, 3, 3, 3, 3, 3, 3, 2, 3, 5  // max years in schooling levels; used w
> hen p518=8, meaning "completed"
.     replace yeduc = yeduc + cond(B5R15<8, B5R15, completionyears[1, B5R15]) if B5R15>0
. 
.     keep  year relate urban yeduc birthyr wt indgen occ birthpl birthprov classwk lwage lhwage birthlat birt
> hlong  // "birth" fields are actually for residence
.     order year relate urban yeduc birthyr wt indgen occ birthpl birthprov classwk lwage lhwage birthlat birt
> hlong
.     save SUSENAS1314, replace
.   }
. 
. 
.   * 1995 data
. 
.   if "$source95"=="IPUMS" {
.     odbc load, clear dsn("Duflo 2001") exec("select RELATE, YRSCHOOL, 2-URBAN as urban, ID1995A_BIRTHYR as b
> irthyr, PERWT, BPLREG, BPLPROV, OCC, INDGEN, CLASSWK, SALCASH, SALGOODS, HRSWORK, birthlat, birthlong from [
> IPUMS-based dataset] where Male=1 and YEAR=1995")
.     ren (YRSCHOOL RELATE PERWT BPLREG BPLPROV OCC INDGEN CLASSWK) (yeduc relate weight birthpl birthprov occ
>  indgen classwk)  // match names in Duflo data set
.     replace yeduc=11 if yeduc==93  // 9 people marked as being in 4th year of vocational senior high school;
>  call it 11 years
.     gen wage = SALCASH + SALGOODS
.     gen hwage = wage / 4 / HRSWORK
.     gen lwage = ln(wage / 1000)
.     gen lhwage = ln(hwage)
.   }
.   else {
.     if "$source95" == "NBER" {
.       use supp95_04 if p503==1 & p509prop!=96, clear  // male, not born abroad
--Break--
r(1);
--Break--
r(1);
--Break--
r(1);

end of do-file

--Break--
r(1);

. do "C:\Users\drood\AppData\Local\Temp\STD36d0_000000.tmp"

. cap log close
